(function(e){var r={};function n(o){if(r[o])return r[o].exports;var t=r[o]={i:o,l:!1,exports:{}};return e[o].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=e,n.c=r,n.d=function(e,r,o){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:o})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var t in e)n.d(o,t,function(r){return e[r]}.bind(null,t));return o},n.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s="2c1e")})({"2c1e":function(e,r){importScripts("https://cdn.jsdelivr.net/npm/js-combinatorics@0.5.5/combinatorics.min.js");var n=["Criticism","Reality Check","Heroic Tale","Comforting Cheer","Cute Cheer","Heroic Cheer","Sad Memory","Joyful Memory","Happy Memories","Unique Comment","Self-Indulgent","Occult","Myth","Bizarre Story","Food Story","Horror Story","Gossip","Dream","Advice","Complain","Belief","Interesting Story"],o={},t=[],i=[],s=[],a={kluri:"falconer-kluri","butcher-corps-inquisitor":"chaos-inquisitor",roozid:"righteous-thief-roozid",helga:"mercenary-helga","church-of-ilryos-axe":"chaos-sect-axe",rikoris:"captain-rikoris",lorina:"commander-lorina",hazel:"mascot-hazel",montmorancy:"angelic-montmorancy",carrot:"researcher-carrot",wanda:"allrounder-wanda",ras:"adventurer-ras",pearlhorizon:"doll-maker-pearlhorizon",doris:"magic-scholar-doris",carmainerose:"zealot-carmainerose",rima:"muse-rima",pyllis:"shadow-knight-pyllis",glenn:"vigilante-leader-glenn",adin:"verdant-adin"};function l(){for(var e=[],r=0;r<n.length;r++)e.push(n[r]);return Combinatorics.combination(e,2).toArray()}function c(e){if(0===Object.keys(o).length){var r=l();for(var n in e)if(e[n].camping&&e[n].camping.values)for(var t=0;t<r.length;t++){var i=r[t];o[i.join("_")]||(o[i.join("_")]={},o[i.join("_")]["heroes"]=[],o[i.join("_")][i[0]]=[],o[i.join("_")][i[1]]=[]),e[n].camping.topics.includes(i[0])&&o[i.join("_")][i[0]].push({_id:e[n]._id,score:e[n].camping.values[i[1]]}),e[n].camping.topics.includes(i[1])&&o[i.join("_")][i[1]].push({_id:e[n]._id,score:e[n].camping.values[i[0]]}),o[i.join("_")]["heroes"].push({_id:e[n]._id,score:e[n].camping.values[i[0]]+e[n].camping.values[i[1]]}),o[i.join("_")]["heroes"].sort((function(e,r){return e.score>r.score?-1:e.score==r.score?0:1})),o[i.join("_")][i[0]].sort((function(e,r){return e.score>r.score?-1:e.score==r.score?0:1})),o[i.join("_")][i[1]].sort((function(e,r){return e.score>r.score?-1:e.score==r.score?0:1}))}}}function u(e,r,n){for(var o in e){var t=e[o];for(var i in t)for(var s=0;s<t[i].length;s++)r.includes(t[i][s]._id)||n.includes(t[i][s]._id)?t[i][s].roster=!0:t[i][s].roster=!1}}function f(e,r,n,o,t){for(var i=0;i<n.heroes.length;i++){var s=!1,a=n.heroes[i]._id;if(n.heroes[i].roster&&!r.includes(a)){for(var l=i+1;l<n.heroes.length;l++){var c=!1,u=n.heroes[l]._id;if(n.heroes[l].roster&&!r.includes(u))if(2===r.length){var f=e+n.heroes[i].score+n.heroes[l].score;if(o[o.length-1].morale>f){l===i+1&&(s=!0);break}t([a,u],f)}else{for(var h=l+1;h<n.heroes.length;h++){var d=n.heroes[h]._id;if(n.heroes[h].roster&&!r.includes(d)){if(f=n.heroes[i].score+n.heroes[l].score+n.heroes[h].score,o[o.length-1].morale>f){h===l+1&&(c=!0);break}t([a,u,d],f)}}if(c)break}}if(s)break}}}function h(e,r){if(r.length>0)for(var n=0;n<r.length;n++){if(-100===r[n].morale)break;if(r[n].team.includes(e[0])&&r[n].team.includes(e[1])&&r[n].team.includes(e[2])&&r[n].team.includes(e[3]))return n}return-1}function d(e,r){for(var n=0;n<e.length;n++){if(e[n].team.length<3){e.splice(n);break}e[n].team.sort((function(e){return r.includes(e)?1:-1}))}}function g(e){for(var r=[[]],n=0;n<e.length;n++){for(var o=e[n],t=[],i=0;i<r.length;i++)for(var s=0;s<o.length;s++)_(r[i].concat(o[s]))||t.push(r[i].concat(o[s]));r=t}return r}function m(e,r,n,o){for(var t=[],i=0;i<e.length;i++){var s=e[i];if(n[s].camping.topics&&(!o||!r.includes(s)))for(var a=0;a<n[s].camping.topics.length;a++){for(var l={hero:s,topic:n[s].camping.topics[a],score:0},c=0;c<e.length;c++)i!==c&&(l.score+=n[e[c]].camping.values[l.topic]);t.push(l)}}if(0===t.length)return null;t.sort((function(e,r){return e.score>r.score?-1:e.score==r.score?0:1}));while(t[0].topic===t[1].topic)t.splice(1,1);return{morale:t[0].score+t[1].score,scores:[t[0].score,t[1].score],topics:[t[0].topic,t[1].topic],holder:[t[0].hero,t[1].hero],team:e}}function p(e){if(!e)return 0;var r=0;for(var n in e)r+=e[n];return r}function v(e,r){for(var n=0;n<r.length;n++)if(!e.includes(r[n]))return!1;return!0}function b(e){for(var r=0;r<e.length;r++)if(a[e[r]]&&e.includes(a[e[r]]))return!0;return!1}function _(e){return e.some((r,n)=>e.indexOf(r)!==n)}function y(e,r,n,o,t){for(var i={},s=0;s<e.length;s++){var a=r[e[s]][o];i[a]=(i[a]||0)+1}for(const l in n)if(!i[l]||i[l]<n[l]||t&&i[l]!==n[l])return!1;return!0}onmessage=function(e){var r=e.data.payload,n=r.message,a=e.data.id,l=r.HeroDB,_=r.locked||[],k=r.roster||[],j=r.advanced||{},C=j.role,O=j.fixedNumberOfAttributes,M=j.attribute,S=j.fixedNumberOfAttributes,x=j.debuffs||[],A=j.buffs||[],z=j.muteLockedHeroes,E=j.aoe,H=j.noS1debuffs,w=j.noDebuffs,P=j.includeDispel,R=j.includeCleanser,T=j.cartesianLock||[[],[],[],[]];for(q=0;q<_.length;q++)k.includes(_)&&k.splice(k.indexOf(_[q]),1);if("BOOT_OPERATIONS"===n)c(l);else{if("FRIENDSHIP"===n){c(l),u(o,k,_);let e=new Array(200).fill({morale:-100,team:[]});for(var D in o){for(var I=o[D],L=D.split("_"),N=null,B=0;B<_.length;B++)for(var q=0;q<o[D].heroes.length;q++)I.heroes[q]._id==_[B]&&I.heroes[q].score>e[e.length-1].morale&&(N=q);if(N)for(q=0;q<I[L[0]].length;q++)if(I[L[0]][q].roster)for(var F=I[L[0]][q].score,G=I[L[0]][q]._id,U=0;U<I[L[1]].length;U++){var Y=I[L[1]][U].score,J=I[L[1]][U]._id;if(I[L[1]][U].roster){var K=0;K=_.includes(G)||_.includes(J)?_.includes(G)?_.includes(J)?0:F:_.includes(J)?Y:0:I.heroes[N].score;for(var Q=0;Q<e.length;Q++)if(K>=e[Q].morale){var V=G!=J?[G,J]:[G];for(B=0;B<_.length;B++)V.includes(_[B])||V.push(_[B]);if(K===e[Q].morale&&V.length>e[Q].team.length)continue;if(b(V))break;var W=h(V,e),X={morale:K,team:V,holder:[G,J],topics:[L[0],L[1]],scores:[0,0]};-1===W?(e.splice(Q,0,X),e.splice(200,1)):W>=Q&&(e.splice(W,1),e.splice(Q,0,X));break}}}}for(q=0;q<e.length;q++){if(-100==e[q].morale){e.splice(q);break}e[q].team.sort((function(e){return _.includes(e)?1:-1}))}return postMessage({id:a,risultati:e})}if("CHARACTER_SYNERGY"===n){console.log(l);var Z=_[0],$=l[Z].camping.values,ee=Object.keys($).map(e=>[e,$[e]]).sort((e,r)=>e[1]>r[1]?-1:1),re=[];for(q in l){const e=l[q];if(!e.camping||!e.camping.values)continue;const r=e.camping.values;var ne=[];ee.forEach(e=>ne.push([e[0],r[e[0]]])),re.push([q].concat(ne))}return re.sort((e,r)=>e[1][1]+e[2][1]>r[1][1]+r[2][1]?-1:1),postMessage({id:a,risultati:re.map(e=>e[0])})}if("CALCULATE_MORALE"===n){var oe,te=new Array(200).fill({morale:-100,team:[]}),ie=p(C),se=p(M),ae=!!T.flat().length;if(_.length+T.filter(e=>e.length>0).length+ie>4||_.length+T.filter(e=>e.length>0).length+se>4)return postMessage({id:a,error:"team_size_exceded"});if(b(_))return postMessage({id:a,error:"error_sc_and_base_form_locked"});if((ae||ie||se||_.length>1)&&(oe=!0),oe){for(var le=0;le<T.length;le++)T[le].length||(T.splice(le,1),le--);if(ae)for(le=0;le<k.length;le++){var ce=T.flat();ce.includes(k[le])&&(k.splice(le,1),le--)}if(T.length+_.length<4&&k.length<4-(T.length+_.length))return postMessage({id:a,error:"not_enough_heroes"});if(T.length+_.length+ie>4||T.length+_.length+se>4)return postMessage({id:a,error:"team_size_exceeded"});var ue=[[]];ae&&(ue=g(T));var fe=0,he=-1,de=Combinatorics.bigCombination(k,4-_.length-ue[0].length||1).length*ue.length;if(ue.forEach(e=>{let r=4-_.length-e.length;Combinatorics.bigCombination(k,r>0?r:1).forEach(r=>{fe++;const n=Math.round(100*fe/de);he!==n&&(he=n,postMessage({id:a,update:n})),e.length+_.length>3&&(r=[]);var o=r.concat(e,_);let c=r;if(!_.every(e=>o.includes(e)))return;if(b(o))return;if(ie>0&&!y(c,l,C,"role",O))return;if(se>0&&!y(c,l,M,"attribute",S))return;if(A.length>0&&!A.every(e=>c.map((function(e){return l[e].buffs})).flat().includes(e)))return;if(x.length>0&&!x.every(e=>c.map((function(e){return l[e].debuffs})).flat().includes(e)))return;if(H&&0!=c.map((function(e){return l[e].skills[0].debuff})).flat().filter((function(e){return 20!=e&&25!=e&&21!=e&&24!=e})).length)return;if(w&&0!=c.map((function(e){return l[e].debuffs})).flat().filter((function(e){return 20!=e&&25!=e&&21!=e&&24!=e})).length)return;if(E&&!t.some(e=>c.includes(e)))return;if(P&&!i.some(e=>c.includes(e)))return;if(R&&!s.some(e=>c.includes(e)))return;let u=m(o,_,l,z);if(u&&!(te[te.length-1].morale>=u.morale))for(var f=0;f<te.length;f++)if(u.morale>=te[f].morale){te.splice(f,0,u),te.splice(200,1);break}})}),te[te.length-1].team.length<3)for(B=0;B<te.length;B++)if(te[B].team.length<3){te.splice(B);break}}else{for(var D in c(l),u(o,k,_),o)for(I=o[D],L=D.split("_"),q=0;q<I[L[0]].length;q++)if(!(!I[L[0]][q].roster||z&&_.includes(I[L[0]][q]._id)))for(G=I[L[0]][q]._id,U=0;U<I[L[1]].length;U++){J=I[L[1]][U]._id;if(!(!I[L[1]][U].roster||z&&_.includes(J))){var ge=[G],me=0;G!==J&&(ge.push(J),me=I[L[0]][q].score+I[L[1]][U].score),f(me,ge,I,te,(function(e,r){var n=[].concat(ge,e);if(v(n,_)&&!b(n))for(var o=0;o<te.length;o++)if(r>=te[o].morale){var t={morale:r,team:n,holder:[G,J],topics:[L[0],L[1]],scores:[0,0]},i=h(n,te);-1===i?(te.splice(o,0,t),te.splice(200,1)):i>=o&&(te.splice(i,1),te.splice(o,0,t));break}}))}}d(te,_)}return postMessage({id:a,risultati:te})}}}}});